{"version":3,"sources":["ng-annotate-text.coffee"],"names":[],"mappings":"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","file":"ng-annotate-text-latest.js","sourceRoot":"/source/","sourcesContent":["ngAnnotateText = angular.module \"ngAnnotateText\", []\n\nannotationIdCounter = 0\n\ninsertAt = (text, index, string)->\n\treturn text.substr(0, index) + string + text.substr(index)\n\nsortAnnotationsByEndIndex = (annotations)->\n\treturn annotations.sort (a, b)->\n\t\tif a.endIndex < b.endIndex\n\t\t\treturn -1\n\t\telse if a.endIndex > b.endIndex\n\t\t\treturn 1\n\t\treturn 0\n\nparseAnnotations = (text, annotations = [], indexOffset = 0)->\n\tif annotations.length is 0\n\t\treturn text\n\tannotations = sortAnnotationsByEndIndex annotations\n\n\tfor i in [annotations.length - 1..0] by -1\n\t\tannotation = annotations[i];\n\t\ttext = insertAt text, annotation.endIndex + indexOffset, \"</span>\"\n\t\tif annotation.children.length\n\t\t\ttext = parseAnnotations text, annotation.children, annotation.startIndex + indexOffset\n\t\ttext = insertAt text, annotation.startIndex + indexOffset, \"<span class=\\\"ng-annotate-text-annotation ng-annotate-text-\" + annotation.id + \" ng-annotate-text-type-\" + annotation.type + \"\\\" data-annotation-id=\\\"\" + annotation.id + \"\\\">\"\n\treturn text\n\ngetAnnotationById = (annotations, aId)->\n\tfor a in annotations\n\t\tif aId is a.id\n\t\t\treturn a\n\t\tif a.children.length > 0\n\t\t\tan = getAnnotationById a.children, aId\n\t\t\tif an isnt undefined\n\t\t\t\treturn an\n\nngAnnotateText.factory \"NGAnnotateTextPopup\", ->\n\t(args) ->\n\t\targs = angular.extend {\n\t\t\tscope: null,\n\t\t\tcallbacks: {},\n\t\t\ttemplate: \"<div/>\"\n\t\t\t$anchor: null\n\t\t\tpreferredAxis: 'x'\n\t\t\toffset: 0\n\t\t\tpositionClass: '{{position}}'\n\t\t}, args\n\n\t\tangular.extend @, args,\n\t\t\t$el: angular.element args.template\n\n\t\t\tshow: (speed = \"fast\") ->\n\t\t\t\t@$el.fadeIn speed\n\t\t\t\t@reposition()\n\t\t\t\tif typeof @callbacks.show is \"function\"\n\t\t\t\t\t@callbacks.show @$el\n\n\t\t\thide: (speed = \"fast\")->\n\t\t\t\t@$el.fadeOut speed\n\t\t\t\tif typeof @callbacks.hide is \"function\"\n\t\t\t\t\t@callbacks.hide @$el\n\n\t\t\tisVisible: ->\n\t\t\t\treturn @$el.is \":visible\"\n\n\t\t\tdestroy: (cb = angular.noop)->\n\t\t\t\tscope = @scope\n\t\t\t\t$el = @$el\n\t\t\t\t@hide ->\n\t\t\t\t\tif typeof cb is \"function\"\n\t\t\t\t\t\tcb()\n\t\t\t\t\tscope.$destroy()\n\t\t\t\t\t$el.remove()\n\n\t\t\tstopDestroy: ->\n\t\t\t\t@$el.stop(true).show(\"fast\")\n\n\t\t\treposition: ->\n\t\t\t\ttargetEl = @$el[0]\n\t\t\t\tanchorEl = @$anchor[0]\n\n\t\t\t\tif not (targetEl or anchorEl)\n\t\t\t\t\treturn\n\n\t\t\t\tpos =\n\t\t\t\t\tleft: null\n\t\t\t\t\ttop: null\n\t\t\t\t\ttarget: targetEl.getBoundingClientRect()\n\t\t\t\t\tanchor: anchorEl.getBoundingClientRect()\n\t\t\t\t\tviewport:\n\t\t\t\t\t\twidth: window.innerWidth\n\t\t\t\t\t\theight: window.innerHeight\n\t\t\t\t\tscroll:\n\t\t\t\t\t\ttop: document.body.scrollTop\n\t\t\t\t\t\tleft: document.body.scrollLeft\n\n\t\t\t\tif not (pos.target.width > 0 and pos.target.height > 0)\n\t\t\t\t\treturn\n\n\t\t\t\t# Find first axis position\n\n\t\t\t\tposX = @getNewPositionOnAxis pos, 'x'\n\t\t\t\tposY = @getNewPositionOnAxis pos, 'y'\n\n\t\t\t\tif @preferredAxis is 'x'\n\t\t\t\t\tif posX and typeof posX.pos is 'number'\n\t\t\t\t\t\tpos.left = posX.pos\n\t\t\t\t\t\tpos.edge = posX.edge\n\t\t\t\t\telse if posY\n\t\t\t\t\t\tpos.top = posY.pos\n\t\t\t\t\t\tpos.edge = posY.edge\n\t\t\t\telse\n\t\t\t\t\tif posY and typeof posY.pos is 'number'\n\t\t\t\t\t\tpos.top = posY.pos\n\t\t\t\t\t\tpos.edge = posY.edge\n\t\t\t\t\telse if posX\n\t\t\t\t\t\tpos.left = posX.pos\n\t\t\t\t\t\tpos.edge = posX.edge\n\n\t\t\t\t# Center on second axis\n\n\t\t\t\tif pos.left is null and pos.top is null\n\t\t\t\t\t# Center on X and Y axes\n\t\t\t\t\tpos.left = pos.scroll.left + (pos.viewport.width / 2) - (pos.target.width / 2)\n\t\t\t\t\tpos.top = pos.scroll.top + (pos.viewport.height / 2) - (pos.target.height / 2)\n\t\t\t\telse if pos.left is null\n\t\t\t\t\t# Center on X axis\n\t\t\t\t\tpos.left = @getNewCenterPositionOnAxis pos, 'x'\n\t\t\t\telse if pos.top is null\n\t\t\t\t\t# Center on Y axis\n\t\t\t\t\tpos.top = @getNewCenterPositionOnAxis pos, 'y'\n\n\t\t\t\t@$el\n\t\t\t\t\t.addClass pos.edge && @positionClass.replace \"{{position}}\", pos.edge\n\t\t\t\t\t.css\n\t\t\t\t\t\ttop: Math.round(pos.top) || 0\n\t\t\t\t\t\tleft: Math.round(pos.left) || 0\n\n\t\t\t\treturn\n\n\t\t\tgetNewPositionOnAxis: (pos, axis) ->\n\t\t\t\tstart = {x: 'left', y: 'top'}[axis]\n\t\t\t\tend = {x: 'right', y: 'bottom'}[axis]\n\t\t\t\tsize = {x: 'width', y: 'height'}[axis]\n\t\t\t\tif pos.anchor[start] - @offset >= pos.target[size]\n\t\t\t\t\taxisPos =\n\t\t\t\t\t\tpos: pos.scroll[start] + pos.anchor[start] - @offset - pos.target[size]\n\t\t\t\t\t\tedge: start\n\t\t\t\telse if pos.viewport[size] - pos.anchor[end] - @offset >= pos.target[size]\n\t\t\t\t\taxisPos =\n\t\t\t\t\t\tpos: pos.scroll[start] + pos.anchor[end] + @offset\n\t\t\t\t\t\tedge: end\n\t\t\t\taxisPos\n\n\t\t\tgetNewCenterPositionOnAxis: (pos, axis) ->\n\t\t\t\tstart = {x: 'left', y: 'top'}[axis]\n\t\t\t\tsize = {x: 'width', y: 'height'}[axis]\n\t\t\t\tcenterPos = pos.scroll[start] + pos.anchor[start] + (pos.anchor[size] / 2) - (pos.target[size] / 2)\n\t\t\t\tMath.max(pos.scroll[start] + @offset, Math.min(centerPos, pos.scroll[start] + pos.viewport[size] - pos.target[size] - @offset))\n\nngAnnotateText.factory \"NGAnnotation\", ->\n\tAnnotation = (data)->\n\n\t\tangular.extend @,\n\t\t\tid: annotationIdCounter++,\n\t\t\tstartIndex: null\n\t\t\tendIndex: null\n\t\t\tdata: {points: 0}\n\t\t\ttype: \"\"\n\t\t\tchildren: []\n\n\t\tif data?\n\t\t\tangular.extend @, data\n\n\treturn Annotation\n\nngAnnotateText.directive \"ngAnnotateText\", ($rootScope, $compile, $http, $q, $controller, $sce, NGAnnotation, NGAnnotateTextPopup)->\n\trestrict: \"E\"\n\tscope:\n\t\ttext: \"=\"\n\t\tannotations: \"=\"\n\t\treadonly: \"=\"\n\t\tpopupController: \"=\"\n\t\tpopupTemplateUrl: \"=\"\n\t\ttooltipController: \"=\"\n\t\ttooltipTemplateUrl: \"=\"\n\t\tonAnnotate: \"=\"\n\t\tonAnnotateDelete: \"=\"\n\t\tonAnnotateError: \"=\"\n\t\tonPopupShow: \"=\"\n\t\tonPopupHide: \"=\"\n\t\tpopupOffset: \"=\"\n\ttemplate: \"<p ng-bind-html=\\\"content\\\"></p>\"\n\treplace: true\n\n\tcompile: (el, attr) ->\n\t\tattr.readonly ?= false\n\t\t@postLink\n\n\tpostLink: ($scope, element, attrs) ->\n\t\tPOPUP_OFFSET = $scope.popupOffset ? 10\n\n\t\tactivePopup = null\n\t\tactiveTooltip = null\n\n\t\t# Cache the template when we fetch it\n\t\tpopupTemplateData = \"\"\n\t\ttooltipTemplateData = \"\"\n\n\t\tonAnnotationsChange = ->\n\t\t\tif not $scope.text? or !$scope.text.length\n\t\t\t\treturn\n\t\t\tt = parseAnnotations $scope.text, $scope.annotations\n\t\t\t$scope.content = $sce.trustAsHtml t\n\n\t\t# Annotation parsing\n\t\t$scope.$watch \"text\", onAnnotationsChange\n\t\t$scope.$watch \"annotations\", onAnnotationsChange, true\n\n\t\tclearPopup = ->\n\t\t\tif not activePopup?\n\t\t\t\treturn\n\t\t\ttId = activePopup.scope.$annotation.id\n\t\t\tactivePopup.destroy ->\n\t\t\t\tif activePopup.scope.$annotation.id is tId\n\t\t\t\t\tactivePopup = null\n\n\t\tclearTooltip = ->\n\t\t\ttooltip = activeTooltip\n\t\t\tif not tooltip?\n\t\t\t\treturn\n\t\t\ttooltip.destroy ->\n\t\t\t\tif activeTooltip is tooltip\n\t\t\t\t\tactiveTooltip = null\n\n\t\tclearPopups = ->\n\t\t\tclearPopup()\n\t\t\tclearTooltip()\n\n\t\t$scope.$on \"$destroy\", clearPopups\n\t\t$scope.$on \"ngAnnotateText.clearPopups\", clearPopups\n\n\t\tif $scope.popupTemplateUrl\n\t\t\t$http.get($scope.popupTemplateUrl).then (response)->\n\t\t\t\tpopupTemplateData = response.data\n\n\t\tif $scope.tooltipTemplateUrl\n\t\t\t$http.get($scope.tooltipTemplateUrl).then (response)->\n\t\t\t\ttooltipTemplateData = response.data\n\n\t\tremoveChildren = (annotation)->\n\t\t\tfor i in [annotation.children.length - 1..0] by -1\n\t\t\t\ta = annotation.children[i]\n\t\t\t\tremoveChildren a\n\t\t\t\ta.children.splice i, 1\n\n\t\tremoveAnnotation = (id, annotations)->\n\t\t\tfor a, i in annotations\n\t\t\t\tremoveAnnotation id, a.children\n\n\t\t\t\tif a.id is id\n\t\t\t\t\tremoveChildren a\n\t\t\t\t\tannotations.splice i, 1\n\t\t\t\t\treturn\n\n\t\tcreateAnnotation = ->\n\t\t\tannotation = new NGAnnotation()\n\t\t\tsel = window.getSelection()\n\n\t\t\tif sel.isCollapsed\n\t\t\t\tthrow new Error \"NG_ANNOTATE_TEXT_NO_TEXT_SELECTED\"\n\n\t\t\trange = sel.getRangeAt 0\n\n\t\t\tif range.startContainer isnt range.endContainer\n\t\t\t\tthrow new Error \"NG_ANNOTATE_TEXT_PARTIAL_NODE_SELECTED\"\n\n\t\t\tif range.startContainer.parentNode.nodeName is \"SPAN\" # Is a child annotation\n\t\t\t\tparentId = if (attrId = range.startContainer.parentNode.getAttribute(\"data-annotation-id\"))? then parseInt(attrId, 10)\n\t\t\t\tif parentId is undefined\n\t\t\t\t\tthrow new Error \"NG_ANNOTATE_TEXT_ILLEGAL_SELECTION\"\n\t\t\t\tparentAnnotation = getAnnotationById $scope.annotations, parentId\n\n\t\t\t\tannotationParentCollection = parentAnnotation.children\n\t\t\telse\n\t\t\t\tannotationParentCollection = $scope.annotations\n\n\t\t\t# Does this selection has any siblings?\n\t\t\tif annotationParentCollection.length\n\t\t\t\t# Yup, find the previous sibling\n\t\t\t\tprevSiblingSpan = range.startContainer.previousSibling\n\t\t\t\tif prevSiblingSpan?\n\t\t\t\t\tprevSiblingId = if (attrId = prevSiblingSpan.getAttribute(\"data-annotation-id\"))? then parseInt(attrId, 10)\n\t\t\t\t\tif not prevSiblingId?\n\t\t\t\t\t\tthrow new Error \"NG_ANNOTATE_TEXT_ILLEGAL_SELECTION\"\n\n\t\t\t\t\tprevAnnotation = getAnnotationById $scope.annotations, prevSiblingId\n\t\t\t\t\tannotation.startIndex = prevAnnotation.endIndex + range.startOffset\n\t\t\t\t\tannotation.endIndex = prevAnnotation.endIndex + range.endOffset\n\t\t\t\telse\n\t\t\t\t\t# Doesn't have a prev sibling, alrighty then\n\t\t\t\t\tannotation.startIndex = range.startOffset\n\t\t\t\t\tannotation.endIndex = range.endOffset\n\t\t\telse\n\t\t\t\t# Nope\n\t\t\t\tannotation.startIndex = range.startOffset\n\t\t\t\tannotation.endIndex = range.endOffset\n\n\t\t\tannotationParentCollection.push annotation\n\t\t\tclearSelection()\n\t\t\treturn annotation\n\n\t\tclearSelection = ->\n\t\t\tif document.selection\n\t\t\t\tdocument.selection.empty() # Internet Explorer\n\t\t\telse if window.getSelection and window.getSelection().empty\n\t\t\t\twindow.getSelection().empty() # Chrome\n\t\t\telse if window.getSelection and window.getSelection().removeAllRanges\n\t\t\t\twindow.getSelection().removeAllRanges() # Firefox\n\n\t\tonSelect = (event)->\n\t\t\tif popupTemplateData.length is 0\n\t\t\t\treturn\n\n\t\t\ttry\n\t\t\t\tannotation = createAnnotation()\n\t\t\t\t$scope.$apply()\n\t\t\t\t$span = element.find \".ng-annotate-text-\" + annotation.id\n\t\t\tcatch ex\n\t\t\t\tif $scope.onAnnotateError?\n\t\t\t\t\t$scope.onAnnotateError ex\n\n\t\t\t\treturn\n\n\t\t\tclearPopups()\n\n\t\t\tloadAnnotationPopup annotation, $span, true\n\n\t\tonClick = (event)->\n\t\t\tif popupTemplateData.length is 0\n\t\t\t\treturn\n\n\t\t\t$target = angular.element event.target\n\t\t\ttargetId = if (attrId = $target.attr(\"data-annotation-id\"))? then parseInt(attrId, 10)\n\n\t\t\tif not targetId?\n\t\t\t\treturn\n\n\t\t\tif activePopup? and activePopup.scope.$annotation.id is targetId\n\t\t\t\tclearPopup()\n\t\t\t\treturn\n\t\t\tannotation = getAnnotationById $scope.annotations, targetId\n\n\t\t\tclearPopups()\n\n\t\t\tloadAnnotationPopup annotation, $target, false\n\n\t\tonMouseEnter = (event)->\n\t\t\tif tooltipTemplateData.length is 0\n\t\t\t\treturn\n\n\t\t\tevent.stopPropagation()\n\t\t\t$target = angular.element event.target\n\t\t\ttargetId = if (attrId = $target.attr(\"data-annotation-id\"))? then parseInt(attrId, 10)\n\n\t\t\tif activeTooltip? and activeTooltip.scope.$annotation.id is targetId\n\t\t\t\tactiveTooltip.stopDestroy()\n\t\t\t\treturn\n\t\t\telse\n\t\t\t\tclearTooltip()\n\n\t\t\tif not targetId?\n\t\t\t\treturn\n\n\t\t\tannotation = getAnnotationById $scope.annotations, targetId\n\n\t\t\t# We don't want to show the tooltip if a popup with the annotation is open,\n\t\t\t# or if the tooltip has both no comment and points\n\t\t\tif activePopup? or (not annotation.data.comment and not annotation.data.points)\n\t\t\t\treturn\n\n\t\t\ttooltip = new NGAnnotateTextPopup\n\t\t\t\tscope: $rootScope.$new()\n\t\t\t\ttemplate: \"<div class='ng-annotate-text-tooltip' />\"\n\t\t\t\tpositionClass: \"ng-annotate-text-tooltip-docked ng-annotate-text-tooltip-docked-{{position}}\"\n\t\t\t\t$anchor: $target\n\t\t\t\tpreferredAxis: 'y'\n\t\t\t\toffset: POPUP_OFFSET\n\t\t\ttooltip.scope.$annotation = annotation\n\n\t\t\tactiveTooltip = tooltip\n\n\t\t\tlocals =\n\t\t\t\t$scope: tooltip.scope\n\t\t\t\t$template: tooltipTemplateData\n\n\t\t\ttooltip.$el.html locals.$template\n\t\t\ttooltip.$el.appendTo \"body\"\n\n\t\t\tif $scope.tooltipController\n\t\t\t\tcontroller = $controller $scope.tooltipController, locals\n\t\t\t\ttooltip.$el.data \"$ngControllerController\", controller\n\t\t\t\ttooltip.$el.children().data \"$ngControllerController\", controller\n\n\t\t\t$compile(tooltip.$el) tooltip.scope\n\t\t\ttooltip.scope.$apply()\n\t\t\ttooltip.show()\n\n\t\tonMouseLeave = (event)->\n\t\t\tevent.stopPropagation()\n\n\t\t\t$target = angular.element event.target\n\t\t\ttargetId = if (attrId = $target.attr(\"data-annotation-id\"))? then parseInt(attrId, 10)\n\n\t\t\tif not targetId?\n\t\t\t\treturn\n\n\t\t\tclearTooltip()\n\n\t\tloadAnnotationPopup = (annotation, anchor, isNew)->\n\t\t\tpopup = new NGAnnotateTextPopup\n\t\t\t\tscope: $rootScope.$new()\n\t\t\t\tcallbacks:\n\t\t\t\t\tshow: $scope.onPopupShow\n\t\t\t\t\thide: $scope.onPopupHide\n\t\t\t\ttemplate: \"<div class='ng-annotate-text-popup' />\"\n\t\t\t\tpositionClass: \"ng-annotate-text-popup-docked ng-annotate-text-popup-docked-{{position}}\"\n\t\t\t\t$anchor: anchor\n\t\t\t\toffset: POPUP_OFFSET\n\n\t\t\tpopup.scope.$isNew = isNew\n\t\t\tpopup.scope.$annotation = annotation\n\t\t\tpopup.scope.$readonly = $scope.readonly\n\n\t\t\tpopup.scope.$reject = ->\n\t\t\t\tremoveAnnotation annotation.id, $scope.annotations\n\n\t\t\t\tif $scope.onAnnotateDelete?\n\t\t\t\t\t$scope.onAnnotateDelete annotation\n\t\t\t\tclearPopup()\n\t\t\t\treturn\n\n\t\t\tpopup.scope.$close = ->\n\t\t\t\tif $scope.onAnnotate?\n\t\t\t\t\t$scope.onAnnotate popup.scope.$annotation\n\t\t\t\tclearPopup()\n\t\t\t\treturn\n\n\t\t\tactivePopup = popup\n\n\t\t\tlocals =\n\t\t\t\t$scope: popup.scope\n\t\t\t\t$template: popupTemplateData\n\n\t\t\tpopup.$el.html locals.$template\n\t\t\tpopup.$el.appendTo \"body\"\n\n\t\t\tif $scope.popupController\n\t\t\t\tcontroller = $controller $scope.popupController, locals\n\t\t\t\tpopup.$el.data \"$ngControllerController\", controller\n\t\t\t\tpopup.$el.children().data \"$ngControllerController\", controller\n\n\t\t\t$compile(popup.$el) popup.scope\n\t\t\tpopup.scope.$apply()\n\t\t\tpopup.show()\n\n\t\telement.on \"mouseenter\", \"span\", onMouseEnter\n\t\telement.on \"mouseleave\", \"span\", onMouseLeave\n\n\t\telement.on \"mouseup\", (event)->\n\t\t\t# We need to determine if the user actually selected something\n\t\t\t# or if he just clicked on an annotation\n\t\t\tselection = window.getSelection()\n\t\t\tif !selection.isCollapsed and !$scope.readonly\n\t\t\t\t# User has selected something\n\t\t\t\tonSelect event\n\t\t\telse if selection.isCollapsed and event.target.nodeName is \"SPAN\"\n\t\t\t\tonClick event\n\t\t\telse if selection.isCollapsed\n\t\t\t\tclearPopups()\n"]}